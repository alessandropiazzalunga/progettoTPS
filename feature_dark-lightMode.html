
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sport Dashboard - Giornata Completa</title>
    <style>
        /* --- VARIABILI GLOBALI (Colori Base) --- */
        :root {
            --bg-body: #f4f6f8;
            --text-main: #333;
            --text-secondary: #555;
            --card-bg: #ffffff;
            --header-bg: #ffffff;
            --border-color: #eee;
            --card-hover: #fbfbfb;
            --accent-color: #007bff;
            --shadow: 0 4px 15px rgba(0,0,0,0.05);
            
            /* Colori Zone Classifica (ModalitÃ  Chiara) */
            --ucl-bg: #e6fffa; --ucl-border: #38b2ac;
            --el-bg: #fffaf0;  --el-border: #ed8936;
            --rel-bg: #fff5f5; --rel-border: #f56565;
            --even-row: #f7fafc;
        }

        /* --- MODALITÃ€ SCURA (Dark Mode) --- */
        body.dark-mode {
            --bg-body: #121212;
            --text-main: #e0e0e0;
            --text-secondary: #aaa;
            --card-bg: #1e1e1e;
            --header-bg: #1e1e1e;
            --border-color: #333;
            --card-hover: #2d2d2d;
            --accent-color: #4da3ff;
            --shadow: 0 4px 15px rgba(0,0,0,0.5);

            /* Colori Zone Classifica (ModalitÃ  Scura) */
            --ucl-bg: #0f2e2b; --ucl-border: #2c7a7b;
            --el-bg: #2e2415;  --el-border: #dd6b20;
            --rel-bg: #2e1515; --rel-border: #c53030;
            --even-row: #252525;
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background-color: var(--bg-body); color: var(--text-main); transition: background 0.3s, color 0.3s; }
        h1 { text-align: center; margin-bottom: 20px; color: var(--text-main); }
        h2 { color: var(--text-main); }
        h3 { color: var(--text-secondary) !important; }

        /* --- TOGGLE SWITCH (Tasto Scorrere) --- */
        .theme-switch-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            gap: 10px;
            font-weight: bold;
            font-size: 0.9em;
        }
        .theme-switch {
            display: inline-block;
            height: 28px;
            position: relative;
            width: 50px;
        }
        .theme-switch input { display: none; }
        .slider {
            background-color: #ccc;
            bottom: 0;
            cursor: pointer;
            left: 0;
            position: absolute;
            right: 0;
            top: 0;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            background-color: #fff;
            bottom: 4px;
            content: "";
            height: 20px;
            left: 4px;
            position: absolute;
            transition: .4s;
            width: 20px;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: #007bff; }
        input:checked + .slider:before { transform: translateX(22px); }

        /* --- STRUTTURA --- */
        .sport-section {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            overflow: hidden;
            transition: background 0.3s;
        }
       
        .section-header {
            background-color: var(--header-bg);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .section-header h2 { margin: 0; font-size: 1.4em; display: flex; align-items: center; gap: 10px; }
        .section-content { padding: 20px; }
 
        .container-flex { display: flex; flex-wrap: wrap; gap: 20px; }
        .box { flex: 1; min-width: 340px; }
        .box h3 { font-size: 1.1em; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 15px; border-bottom: 2px solid var(--accent-color); display: inline-block; padding-bottom: 5px; }
 
        /* SCROLL E DATE */
        .scrollable-box { max-height: 600px; overflow-y: auto; padding-right: 5px; }
        .scrollable-box::-webkit-scrollbar { width: 6px; }
        .scrollable-box::-webkit-scrollbar-thumb { background-color: #cbd5e0; border-radius: 4px; }
        .scrollable-box::-webkit-scrollbar-track { background: transparent; }
 
        .date-divider {
            background-color: var(--border-color);
            color: var(--text-secondary);
            padding: 8px 12px;
            font-size: 0.85em;
            font-weight: bold;
            border-radius: 6px;
            margin: 15px 0 8px 0;
            text-transform: capitalize;
        }
 
        /* CARD PARTITA */
        .match-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s;
        }
        .match-card:hover { border-color: #cbd5e0; background-color: var(--card-hover); }
 
        .team { display: flex; align-items: center; gap: 10px; font-weight: 600; font-size: 0.95em; width: 40%; color: var(--text-main); }
        .team img { width: 28px; height: 28px; object-fit: contain; }
        .team.away { justify-content: flex-end; text-align: right; }
       
        .score-info { width: 20%; text-align: center; display: flex; flex-direction: column; justify-content: center; }
        .score { font-size: 1.3em; font-weight: 700; color: var(--text-main); letter-spacing: 1px; }
        .status { font-size: 0.75em; color: var(--text-secondary); margin-top: 3px; }
       
        .live-text { color: #e53e3e; font-weight: bold; animation: pulse 1.5s infinite; }
       
        /* TABELLA CLASSIFICA */
        table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
        th, td { padding: 10px 8px; text-align: center; border-bottom: 1px solid var(--border-color); color: var(--text-main); }
        th { background-color: #2d3748; color: white; font-weight: 500; font-size: 0.85em; text-transform: uppercase; }
        td:nth-child(2) { text-align: left; font-weight: 600; display: flex; align-items: center; gap: 8px; }
        td img { width: 24px; height: 24px; }
        
        tr:nth-child(even) { background-color: var(--even-row); }
       
        /* Classi dinamiche per le zone classifica */
        .zone-ucl { background-color: var(--ucl-bg) !important; border-left: 3px solid var(--ucl-border); }
        .zone-el { background-color: var(--el-bg) !important; border-left: 3px solid var(--el-border); }
        .zone-rel { background-color: var(--rel-bg) !important; border-left: 3px solid var(--rel-border); }

        .conf-title { background: var(--border-color); padding: 8px; font-size: 0.9em; font-weight: bold; margin-top: 20px; text-align: center; border-radius: 4px; color: var(--text-secondary); }
 
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>
 
<!-- INTERRUTTORE TEMA -->
<div class="theme-switch-wrapper">
    <span>Light mode</span>
    <label class="theme-switch" for="checkbox">
        <input type="checkbox" id="checkbox" />
        <div class="slider"></div>
    </label>
    <span>Dark Mode</span>
</div>

<h1>Calendario e Classifiche Live</h1>
 
<!-- SERIE A -->
<div class="sport-section">
    <div class="section-header">
        <h2><img src="https://a.espncdn.com/combiner/i?img=/i/leagues/soccer/ita.1.png&w=40&h=40" alt=""> Serie A</h2>
    </div>
    <div class="section-content">
        <div class="container-flex">
            <div class="box">
                <h3></h3>
                <div id="seriea-scores" class="scrollable-box">Caricamento partite...</div>
            </div>
            <div class="box">
                <h3>Classifica</h3>
                <div id="seriea-standings" class="scrollable-box">Caricamento classifica...</div>
            </div>
        </div>
    </div>
</div>
 
<!-- NBA -->
<div class="sport-section">
    <div class="section-header">
        <h2><img src="https://a.espncdn.com/combiner/i?img=/i/leagues/nba.png&w=40&h=40" alt=""> NBA</h2>
    </div>
    <div class="section-content">
        <div class="container-flex">
            <div class="box">
                <h3>Partite Recenti e Prossime</h3>
                <div id="nba-scores" class="scrollable-box">Caricamento partite...</div>
            </div>
            <div class="box">
                <h3>Classifiche Conference</h3>
                <div id="nba-standings" class="scrollable-box">Caricamento classifica...</div>
            </div>
        </div>
    </div>
</div>
 
<script>
    // --- GESTIONE DARK MODE ---
    const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
    
    // Controlla se l'utente aveva giÃ  scelto la dark mode in passato
    if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-mode');
        toggleSwitch.checked = true;
    }

    function switchTheme(e) {
        if (e.target.checked) {
            document.body.classList.add('dark-mode');
            localStorage.setItem('theme', 'dark');
        } else {
            document.body.classList.remove('dark-mode');
            localStorage.setItem('theme', 'light');
        }
    }
    toggleSwitch.addEventListener('change', switchTheme);


    // --- UTILITY: CALCOLO DATE ---
    function getWeekRange() {
        const today = new Date();
        const past = new Date(today);
        past.setDate(today.getDate() - 2); 
        const future = new Date(today);
        future.setDate(today.getDate() + 5); 
        const format = (d) => d.toISOString().slice(0, 10).replace(/-/g, "");
        return `${format(past)}-${format(future)}`;
    }
 
    // --- FUNZIONE 1: CARICA PARTITE ---
    async function caricaPartite(sport, league, containerId) {
        const container = document.getElementById(containerId);
        const dateRange = getWeekRange();
        const url = `https://site.api.espn.com/apis/site/v2/sports/${sport}/${league}/scoreboard?dates=${dateRange}&limit=100`;
 
        try {
            const response = await fetch(url);
            const data = await response.json();
            const events = data.events;
 
            if (!events || events.length === 0) {
                container.innerHTML = "<p style='color:var(--text-secondary);'>Nessuna partita in questo intervallo.</p>";
                return;
            }
 
            container.innerHTML = "";
            let lastDate = "";
 
            events.forEach(event => {
                const eventDateObj = new Date(event.date);
                const dateString = eventDateObj.toLocaleDateString('it-IT', { weekday: 'long', day: 'numeric', month: 'long' });
 
                if (dateString !== lastDate) {
                    container.innerHTML += `<div class="date-divider">${dateString}</div>`;
                    lastDate = dateString;
                }
 
                const match = event.competitions[0];
                const home = match.competitors.find(c => c.homeAway === 'home');
                const away = match.competitors.find(c => c.homeAway === 'away');
 
                const homeLogo = home.team.logo || "https://via.placeholder.com/30";
                const awayLogo = away.team.logo || "https://via.placeholder.com/30";
               
                const statusState = event.status.type.state;
                let centerContent = "";
                let statusClass = "status";
 
                if (statusState === 'pre') {
                    const time = eventDateObj.toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' });
                    centerContent = `<div class="score" style="font-size:1.1em; color:var(--accent-color);">${time}</div>`;
                    statusClass += " upcoming";
                } else if (statusState === 'in') {
                    centerContent = `<div class="score">${home.score} - ${away.score}</div>`;
                    statusClass += " live-text";
                    centerContent += `<div class="${statusClass}">ðŸ”´ ${event.status.type.detail}</div>`;
                } else {
                    centerContent = `<div class="score">${home.score} - ${away.score}</div>`;
                    centerContent += `<div class="${statusClass}">Finale</div>`;
                }
 
                container.innerHTML += `
                    <div class="match-card">
                        <div class="team">
                            <img src="${homeLogo}" alt=""> ${home.team.shortDisplayName}
                        </div>
                        <div class="score-info">
                            ${centerContent}
                        </div>
                        <div class="team away">
                            ${away.team.shortDisplayName} <img src="${awayLogo}" alt="">
                        </div>
                    </div>
                `;
            });
 
        } catch (err) {
            console.error(err);
            container.innerHTML = "Errore caricamento partite.";
        }
    }

    // --- FUNZIONE 2: CARICA CLASSIFICA ---
    async function caricaClassifica(sport, league, containerId) {
        const container = document.getElementById(containerId);
        const url = `https://site.api.espn.com/apis/v2/sports/${sport}/${league}/standings`;
 
        try {
            const response = await fetch(url);
            const data = await response.json();
            let html = "";
 
            if(data.children && data.children.length > 0) {
                data.children.forEach(group => {
                    if(league === 'nba') {
                        html += `<div class="conf-title">${group.name}</div>`;
                    }
 
                    html += `
                        <table>
                            <thead>
                                <tr>
                                    <th style="width:30px">#</th>
                                    <th>Squadra</th>
                                    <th style="width:50px">${league === 'ita.1' ? 'Pt' : 'W-L'}</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
 
                    group.standings.entries.forEach((entry, index) => {
                        const teamName = entry.team.shortDisplayName;
                        const logo = entry.team.logos?.[0]?.href || "";
                       
                        let statVal = "";
                        if(league === 'ita.1') {
                            statVal = entry.stats.find(s => s.name === 'points')?.value || 0;
                        } else {
                            const w = entry.stats.find(s => s.name === 'wins')?.value || 0;
                            const l = entry.stats.find(s => s.name === 'losses')?.value || 0;
                            statVal = `${w}-${l}`;
                        }
 
                        // Assegnazione Classi CSS invece di stili inline per supportare la dark mode
                        let rowClass = "";
                        if(league === 'ita.1') {
                            if(index < 4) rowClass = "zone-ucl"; // Champions
                            else if (index < 6) rowClass = "zone-el"; // Europa
                            else if (index >= 17) rowClass = "zone-rel"; // Retrocessione
                        }
 
                        html += `
                            <tr class="${rowClass}">
                                <td>${index + 1}</td>
                                <td><img src="${logo}" alt=""> ${teamName}</td>
                                <td><strong>${statVal}</strong></td>
                            </tr>
                        `;
                    });
                    html += `</tbody></table>`;
                });
            }
            container.innerHTML = html;
 
        } catch (err) {
            console.error(err);
            container.innerHTML = "Errore classifica.";
        }
    }
 
    caricaPartite("soccer", "ita.1", "seriea-scores");
    caricaClassifica("soccer", "ita.1", "seriea-standings");
 
    caricaPartite("basketball", "nba", "nba-scores");
    caricaClassifica("basketball", "nba", "nba-standings");
 
</script>
 
</body>
</html>
